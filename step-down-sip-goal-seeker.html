<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Step-Down SIP Goal Seeker Calculator | India | Find Required SIP Amount</title>
    <meta name="description" content="Free Step-Down SIP Goal Seeker Calculator for India: determine the required starting SIP with yearly step-down to reach your target corpus. See year-wise schedule and growth projection." />
    <meta name="robots" content="index,follow,max-image-preview:large" />
    <link rel="canonical" href="https://financialcalc.ai/step-down-sip-goal-seeker" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Step-Down SIP Goal Seeker Calculator | Find Required SIP for ‚ÇπX Target" />
    <meta property="og:description" content="Calculate the starting SIP amount needed to reach your financial goal with yearly step-down reductions. Perfect for salary-linked SIP planning." />
    <meta property="og:url" content="https://financialcalc.ai/step-down-sip-goal-seeker" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <script type="application/ld+json">
    {
      "@context":"https://schema.org",
      "@type":"FAQPage",
      "mainEntity":[
        {
          "@type":"Question",
          "name":"What is a step-down SIP?",
          "acceptedAnswer":{
            "@type":"Answer",
            "text":"A step-down SIP is a strategy where your monthly investment (or SIP as % of salary) starts high and reduces by a fixed percentage each year. This works well when you expect future salary increases to keep lifestyle constant."
          }
        },
        {
          "@type":"Question",
          "name":"How does this calculator find the required SIP?",
          "acceptedAnswer":{
            "@type":"Answer",
            "text":"The calculator uses a goal-seeking algorithm (binary search) to find the exact starting SIP amount that will grow to your target corpus within the time horizon and constraints."
          }
        },
        {
          "@type":"Question",
          "name":"Are taxes included in this calculator?",
          "acceptedAnswer":{
            "@type":"Answer",
            "text":"No. Results are illustrative and do not include taxes, TDS, expense ratios, or exit loads. Consult a financial advisor for tax-optimized planning."
          }
        }
      ]
    }
    </script>

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      /* Header Styling */
      header {
        background: var(--card, white);
        border-bottom: 1px solid var(--border, #d1e7e4);
        padding: 16px 0;
        position: sticky;
        top: 0;
        z-index: 100;
      }
      
      .header-content {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 clamp(16px, 3vw, 40px);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .logo {
        font-weight: 700;
        font-size: 20px;
        text-decoration: none;
        color: var(--ink, #0f2f2e);
      }
      
      .mobile-menu-toggle {
        display: none;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--ink, #0f2f2e);
      }
      
      nav {
        display: flex;
      }
      
      .nav-links {
        display: flex;
        gap: 32px;
        list-style: none;
        padding: 0;
        margin: 0;
      }
      
      .nav-links a {
        text-decoration: none;
        color: var(--ink, #0f2f2e);
        font-size: 14px;
        font-weight: 500;
        transition: color 0.3s ease;
      }
      
      .nav-links a:hover {
        color: var(--brand, #0d9488);
      }
      
      @media (max-width: 700px) {
        .mobile-menu-toggle {
          display: block;
        }
        
        nav {
          display: none;
        }
        
        nav.active {
          display: flex;
          position: absolute;
          top: 100%;
          left: 0;
          right: 0;
          flex-direction: column;
          background: var(--card, white);
          border-bottom: 1px solid var(--border, #d1e7e4);
          padding: 16px;
        }
        
        .nav-links {
          flex-direction: column;
          gap: 12px;
        }
      }

      @media (min-width: 1000px) {
        section[style*="grid-template-columns"] {
          gap: 10px !important;
        }
        .main-card-min {
          min-width: 420px;
        }
        .results-card-min {
          min-width: 400px;
        }
      }
      :root {
        --section-gap: clamp(16px, 3vw, 40px);
        --card-padding: clamp(10px, 3vw, 32px);
        --section-padding: clamp(8px, 2vw, 24px);
      }
      @media (max-width: 1200px) {
        .wrap {
          padding: 24px 2vw 60px 2vw;
        }
        .grid,
        section[style*="grid-template-columns"] {
          grid-template-columns: 1fr !important;
        }
      }
      @media (max-width: 900px) {
        .wrap {
          padding: 12px 1vw 30px 1vw;
        }
        .grid,
        section[style*="grid-template-columns"] {
          grid-template-columns: 1fr !important;
        }
        .card, .seo-card {
          padding: 12px 6px !important;
        }
        .results, .chart, .legend, .foot {
          font-size: 13px;
        }
        h1, h2 {
          font-size: 1.1rem !important;
        }
        table {
          font-size: 12px;
        }
      }
      @media (max-width: 700px) {
        .wrap {
          padding: 4px 0 10px 0;
        }
        .hero {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }
        .card, .seo-card {
          padding: 8px 2px !important;
          border-radius: 10px;
        }
        .results, .chart, .legend, .foot {
          font-size: 11px;
        }
        h1, h2 {
          font-size: 1rem !important;
        }
        table {
          font-size: 10px;
        }
        section[style*="grid-template-columns"], .grid {
          grid-template-columns: 1fr !important;
        }
        section[style*="grid-template-columns"] > div,
        .grid > div {
          min-width: 0;
          width: 100% !important;
          max-width: 100vw;
        }
      }
      :root {
        --bg: #f0fdf9;
        --ink: #0f2f2e;
        --muted: #64748b;
        --brand: #0d9488;
        --brand-2: #0f766e;
        --accent: #5eead4;
        --card: #ffffff;
        --border: #d1e7e4;
        --shadow: 0 12px 32px rgba(13, 148, 136, 0.12);
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Inter", system-ui, -apple-system, Segoe UI, sans-serif;
        color: var(--ink);
        background: var(--bg);
        min-height: 100vh;
      }
      .wrap {
        width: 100%;
        padding: var(--section-gap);
      }
      header {
        margin-bottom: 18px;
      }
      .logo {
        font-weight: 700;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--brand);
      }
      .hero {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        gap: 20px;
        flex-wrap: wrap;
      }
      h1 {
        margin: 0;
        font-size: clamp(26px, 3.4vw, 34px);
        line-height: 1.2;
        font-weight: 600;
      }
      .sub {
        color: var(--muted);
        max-width: 560px;
        margin: 8px 0 0;
        font-size: 14px;
        line-height: 1.5;
      }
      .pill {
        background: #eafaf5;
        color: #129a79;
        padding: 4px 12px;
        border-radius: 999px;
        font-weight: 600;
        font-size: 12px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--section-gap);
        margin-top: var(--section-gap);
      }
      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        box-shadow: var(--shadow);
        padding: var(--card-padding);
        min-width: 0;
        width: 100%;
        box-sizing: border-box;
      }
      .field {
        display: grid;
        gap: 10px;
        margin-bottom: 14px;
      }
      .field label {
        font-weight: 600;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }
      .unit {
        font-size: 14px;
        color: #9aa3b2;
        font-weight: 600;
        letter-spacing: 0.04em;
      }
      .input-row {
        display: grid;
        grid-template-columns: 1fr 120px;
        gap: 12px;
        align-items: center;
      }
      input[type="range"] {
        width: 100%;
        accent-color: var(--brand);
        height: 4px;
        background: #e5e7eb;
        border-radius: 999px;
      }
      input[type="range"]::-webkit-slider-runnable-track {
        height: 4px;
        border-radius: 999px;
        background: transparent;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 1000%;
        background: var(--brand);
        border: none;
        margin-top: -6px;
        box-shadow: 0 4px 10px rgba(0, 208, 156, 0.35);
      }
      input[type="range"]::-moz-range-track {
        height: 4px;
        border-radius: 999px;
        background: transparent;
      }
      input[type="number"] {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-weight: 600;
        font-size: 13px;
        background: #fff;
        color: var(--ink);
      }
      input[type="text"] {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-weight: 600;
        font-size: 13px;
        background: #fff;
        color: var(--ink);
      }
      .results {
        display: grid;
        gap: 8px;
      }
      .result-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-weight: 600;
        padding: 10px 12px;
        background: #f8f9fb;
        border-radius: 10px;
      }
      .result-row span {
        color: #6b7280;
        font-weight: 500;
      }
      .warning-card {
        background: #fef3c7;
        border: 1px solid #f59e0b;
        border-radius: 10px;
        padding: 12px;
        margin-bottom: 14px;
        color: #92400e;
        font-weight: 500;
        font-size: 13px;
      }
      .toggle-group {
        display: flex;
        gap: 8px;
        margin-bottom: 14px;
      }
      .toggle-btn {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid var(--border);
        background: #fff;
        color: var(--ink);
        border-radius: 8px;
        font-weight: 600;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .toggle-btn.active {
        background: var(--brand);
        color: #fff;
        border-color: var(--brand);
      }
      .cta {
        margin-top: 18px;
        background: var(--brand);
        border: none;
        color: #fff;
        padding: 12px 16px;
        width: 100%;
        border-radius: 10px;
        font-weight: 600;
        font-size: 13px;
        letter-spacing: 0.03em;
        box-shadow: 0 8px 18px rgba(0, 208, 156, 0.25);
        cursor: pointer;
      }
      .foot {
        margin-top: 18px;
        color: #9aa3b2;
        font-size: 12px;
      }
      @media (max-width: 900px) {
        .grid {
          grid-template-columns: 1fr;
        }
        .input-row {
          grid-template-columns: 1fr;
        }
      }
      .seo-section {
        width: 100%;
        margin: var(--section-gap) 0;
        display: flex;
        flex-direction: column;
        gap: var(--section-gap);
        padding: 0;
      }
      .seo-card {
        background: var(--card);
        border: 1.5px solid #d1e7e4;
        border-radius: 18px;
        box-shadow: 0 8px 32px rgba(13, 148, 136, 0.10);
        padding: var(--card-padding);
        line-height: 1.85;
        font-size: 1.08rem;
        color: #18313a;
        transition: box-shadow 0.2s;
        min-width: 0;
        width: 100%;
        box-sizing: border-box;
      }
      .seo-card h2 {
        font-size: 1.45rem;
        margin-bottom: 18px;
        color: var(--brand-2);
        font-weight: 700;
        letter-spacing: 0.01em;
      }
      .seo-card p, .seo-card ul, .seo-card ol {
        margin-bottom: 16px;
      }
      .seo-card ul, .seo-card ol {
        padding-left: 24px;
        margin-top: 0;
      }
      .seo-card li {
        margin-bottom: 10px;
        line-height: 1.7;
      }
      .seo-card strong {
        color: var(--brand);
      }
      .seo-card em {
        color: #64748b;
        font-style: italic;
      }
    </style>
  </head>
  <body>
  <!-- Header -->
  <header>
    <div class="header-content">
      <a href="index.html" class="logo">üí∞ FinancialCalc.Ai</a>
      <button class="mobile-menu-toggle" aria-label="Toggle menu">‚ò∞</button>
      <nav>
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="index.html#investing">Investing</a></li>
          <li><a href="index.html#home-decisions">House Decisions</a></li>
          <li><a href="index.html#loans">Loans</a></li>
          <li><a href="index.html#retirement">Retirement</a></li>
          <li><a href="contact.html">Contact Us</a></li>
        </ul>
      </nav>
    </div>
  </header>

    <div class="wrap">
      <header>
        <div class="logo">Calculator Suite</div>
        <div class="hero">
          <div>
            <h1>Step-Down SIP Goal Seeker</h1>
            <p class="sub">
              Determine the starting SIP needed to reach your target corpus with annual step-down reductions‚Äîideal for salary-linked planning.
            </p>
          </div>
          <div class="pill">For Self Use ‚Ä¢ NEW REGIME</div>
        </div>
      </header>

      <!-- Main Grid: Inputs + Results -->
      <section class="grid">
        <!-- Left: Inputs Section -->
        <div class="card main-card-min">
          <h2 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Inputs</h2>

          <!-- Target Corpus -->
          <div class="field">
            <label>Target Corpus <span class="unit">‚Çπ</span></label>
            <div class="input-row">
              <input type="range" id="targetCorpusRange" min="100000" max="100000000" step="100000" value="5000000" />
              <input type="number" id="targetCorpusInput" placeholder="e.g., 50,00,000" min="100000" max="1000000000" value="5000000" />
            </div>
          </div>

          <!-- Time Horizon -->
          <div class="field">
            <label>Time Horizon <span class="unit">Years</span></label>
            <div class="input-row">
              <input type="range" id="horizonRange" min="1" max="60" value="15" />
              <input type="number" id="horizonInput" min="1" max="60" value="15" />
            </div>
          </div>

          <!-- Expected Return -->
          <div class="field">
            <label>Expected Return (p.a.) <span class="unit">%</span></label>
            <div class="input-row">
              <input type="range" id="returnRange" min="0" max="30" step="0.1" value="12" />
              <input type="number" id="returnInput" min="0" max="30" step="0.1" value="12" />
            </div>
          </div>

          <!-- Current Monthly Salary -->
          <div class="field">
            <label>Current Monthly Salary <span class="unit">‚Çπ</span></label>
            <div class="input-row">
              <input type="range" id="salaryRange" min="10000" max="50000000" step="10000" value="100000" />
              <input type="number" id="salaryInput" placeholder="e.g., 1,00,000" min="10000" max="50000000" value="100000" />
            </div>
          </div>

          <!-- Starting SIP % Range (display only, fixed bounds) -->
          <div class="field">
            <label>Starting SIP % of Salary <span class="unit">Fixed: 20‚Äì60%</span></label>
            <div style="font-size: 13px; color: #6b7280;">
              Min: <strong id="sipMinDisplay">‚Çπ 20,000</strong> | Max: <strong id="sipMaxDisplay">‚Çπ 60,000</strong>
            </div>
          </div>

          <!-- Step-down Rate -->
          <div class="field">
            <label>Step-down Rate (% per year) <span class="unit">%</span></label>
            <div class="input-row">
              <input type="range" id="stepdownRange" min="0" max="50" step="0.5" value="5" />
              <input type="number" id="stepdownInput" min="0" max="50" step="0.5" value="5" />
            </div>
            <div style="font-size: 12px; color: #9aa3b2;">SIP reduces by this % each year. E.g., 5% means Year 2 = Year 1 √ó 95%</div>
          </div>

          <!-- Salary Growth (Optional) -->
          <div class="field">
            <label>Annual Salary Growth (%) <span class="unit">%</span></label>
            <div class="input-row">
              <input type="range" id="salaryGrowthRange" min="0" max="20" step="0.5" value="0" />
              <input type="number" id="salaryGrowthInput" min="0" max="20" step="0.5" value="0" />
            </div>
          </div>

          <!-- Mode Toggle: Auto vs Manual -->
          <div class="field">
            <label>SIP Selection Mode <span class="unit"></span></label>
            <div class="toggle-group">
              <button class="toggle-btn active" data-mode="auto">Auto (Goal Seek)</button>
              <button class="toggle-btn" data-mode="manual">Manual</button>
            </div>
          </div>

          <!-- Manual Mode: SIP % Slider (hidden by default) -->
          <div id="manualSipSection" style="display: none;">
            <div class="field">
              <label>Starting SIP % <span class="unit">%</span></label>
              <div class="input-row">
                <input type="range" id="manualSipPctRange" min="20" max="60" step="1" value="30" />
                <input type="number" id="manualSipPctInput" min="20" max="60" step="1" value="30" />
              </div>
              <div style="font-size: 12px; color: #9aa3b2;" id="manualSipDisplay">SIP: ‚Çπ 30,000/month (30% of salary)</div>
            </div>
          </div>
        </div>

        <!-- Right: Results Section -->
        <div class="card results-card-min">
          <h2 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Results</h2>
          <div id="warningBox" class="warning-card" style="display: none;"></div>
          <div class="results">
            <div class="result-row">
              <span>Required Starting SIP</span>
              <strong id="requiredSipResult">‚Çπ 0</strong>
            </div>
            <div class="result-row">
              <span>As % of Salary</span>
              <strong id="requiredSipPctResult">0%</strong>
            </div>
            <div style="border-top: 1px dashed #d1d5db; margin: 12px 0;"></div>
            <div class="result-row">
              <span>Final Corpus Achieved</span>
              <strong id="finalCorpusResult">‚Çπ 0</strong>
            </div>
            <div class="result-row">
              <span>Total Invested</span>
              <strong id="totalInvestedResult">‚Çπ 0</strong>
            </div>
            <div class="result-row">
              <span>Total Gain (Returns)</span>
              <strong id="totalGainResult">‚Çπ 0</strong>
            </div>
            <div style="border-top: 1px dashed #d1d5db; margin: 12px 0;"></div>
            <div class="result-row">
              <span>SIP Year 1 (Monthly)</span>
              <strong id="sipYear1Result">‚Çπ 0</strong>
            </div>
            <div class="result-row">
              <span>SIP Year N (Monthly)</span>
              <strong id="sipYearNResult">‚Çπ 0</strong>
            </div>
            <div class="result-row">
              <span>Step-down Applied</span>
              <strong id="stepdownAppliedResult">0%</strong>
            </div>
          </div>
          <button class="cta" id="recalculateBtn">RECALCULATE</button>
          <div class="foot">For illustration only. Actual returns vary by market. Consult a financial advisor.</div>
        </div>
      </section>

      <!-- Growth Chart -->
      <section style="margin-top: 40px;">
        <div class="card">
          <h2 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Corpus Growth Over Time</h2>
          <canvas id="corpusGrowthChart" style="max-height: 400px;"></canvas>
        </div>
      </section>

      <!-- Data Table Section -->
      <section style="margin-top: 40px;">
        <div class="card">
          <h2 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600;">Year-by-Year SIP Schedule</h2>
          <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
              <thead>
                <tr style="background: #f8f9fb; border-bottom: 2px solid var(--border);">
                  <th style="padding: 12px; text-align: left; font-weight: 600; color: #6b7280;">Year</th>
                  <th style="padding: 12px; text-align: right; font-weight: 600; color: #6b7280;">Monthly SIP (‚Çπ)</th>
                  <th style="padding: 12px; text-align: right; font-weight: 600; color: #6b7280;">Annual Contribution (‚Çπ)</th>
                  <th style="padding: 12px; text-align: right; font-weight: 600; color: #6b7280;">Cumulative Invested (‚Çπ)</th>
                  <th style="padding: 12px; text-align: right; font-weight: 600; color: #6b7280;">Corpus at Year End (‚Çπ)</th>
                  <th style="padding: 12px; text-align: right; font-weight: 600; color: #6b7280;">Gain to Date (‚Çπ)</th>
                </tr>
              </thead>
              <tbody id="scheduleTableBody">
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- SEO Content -->
      <div class="seo-section">
        <div class="seo-card">
          <h2>How Does a Step-Down SIP Work?</h2>
          <p>
            A <strong>step-down SIP</strong> is an investment strategy where your monthly contribution decreases by a fixed percentage each year. It is useful when:
          </p>
          <ul>
            <li>You expect salary growth, so reducing SIP keeps lifestyle expenses stable</li>
            <li>You want to maximize investments early while you have higher disposable income</li>
            <li>You aim to reach a target corpus gradually over time</li>
          </ul>
          <p>
            For example, if you start with ‚Çπ50,000/month and apply a 5% step-down:
          </p>
          <ul>
            <li><strong>Year 1:</strong> ‚Çπ50,000/month</li>
            <li><strong>Year 2:</strong> ‚Çπ47,500/month (‚Çπ50,000 √ó 0.95)</li>
            <li><strong>Year 3:</strong> ‚Çπ45,125/month (‚Çπ47,500 √ó 0.95)</li>
            <li>And so on...</li>
          </ul>
        </div>
        <div class="seo-card">
          <h2>How the Goal-Seeking Algorithm Works</h2>
          <p>
            This calculator uses a <strong>binary search algorithm</strong> to find the optimal starting SIP amount that will reach your target corpus:
          </p>
          <ul>
            <li>The calculator computes corpus growth for different starting SIP amounts</li>
            <li>It narrows the search to find the <em>minimum</em> starting SIP that meets your goal</li>
            <li>All amounts are bounded between 20% and 60% of your monthly salary</li>
            <li>If your target is not reachable at the 60% cap, the calculator shows the maximum possible corpus</li>
          </ul>
        </div>
        <div class="seo-card">
          <h2>Final Note and Disclaimer</h2>
          <p>This calculator is for educational and planning purposes only and does not constitute financial advice. Results are illustrative and not guaranteed. Taxes, fees, charges, and market risks are not included in the calculations. Consult a qualified financial advisor before making investment decisions.</p>
        </div>
      </div>
    </div>

    <script>
      // ============ UTILITY FUNCTIONS ============
      function formatINR(num) {
        const fmt = new Intl.NumberFormat("en-IN", {
          style: "currency",
          currency: "INR",
          maximumFractionDigits: 0,
        });
        return fmt.format(num);
      }

      function formatNumberWithCommas(num) {
        const numStr = num.toString();
        const reversed = numStr.split('').reverse();
        let result = '';
        for (let i = 0; i < reversed.length; i++) {
          if (i === 3 || (i > 3 && (i - 3) % 2 === 0)) {
            result += ',';
          }
          result += reversed[i];
        }
        return result.split('').reverse().join('');
      }

      function clamp(value, min, max) {
        return Math.min(max, Math.max(min, value));
      }

      function setRangeFill(rangeEl) {
        const min = Number(rangeEl.min);
        const max = Number(rangeEl.max);
        const value = Number(rangeEl.value);
        const percent = ((value - min) / (max - min)) * 100;
        rangeEl.style.background = `linear-gradient(90deg, var(--brand) ${percent}%, #e5e7eb ${percent}%)`;
      }

      // ============ CORE SIMULATION LOGIC ============
      /**
       * Simulate final corpus for a given starting SIP with step-down
       * @param {number} startingSipMonthly - starting monthly SIP in INR
       * @param {number} horizonYears - investment period
       * @param {number} annualReturnPct - expected annual return %
       * @param {number} stepdownPct - step-down rate % per year
       * @param {number} annualSalaryGrowth - (optional) annual salary growth %
       * @returns {object} { finalCorpus, yearRows, totalInvested }
       */
      function simulateCorpusStepDownSip(startingSipMonthly, horizonYears, annualReturnPct, stepdownPct, annualSalaryGrowth = 0) {
        const monthlyRate = Math.pow(1 + annualReturnPct / 100, 1 / 12) - 1;
        let corpus = 0;
        let totalInvested = 0;
        const yearRows = [];

        for (let year = 1; year <= horizonYears; year++) {
          // Calculate SIP for this year (step-down from year 1)
          const monthlySip = startingSipMonthly * Math.pow(1 - stepdownPct / 100, year - 1);
          const annualContribution = monthlySip * 12;
          
          // Grow corpus and add monthly SIP for 12 months
          for (let month = 0; month < 12; month++) {
            corpus = corpus * (1 + monthlyRate) + monthlySip;
          }
          
          totalInvested += annualContribution;
          const gain = corpus - totalInvested;

          yearRows.push({
            year,
            monthlySip: Math.round(monthlySip),
            annualContribution: Math.round(annualContribution),
            cumulativeInvested: Math.round(totalInvested),
            corpusEndOfYear: Math.round(corpus),
            gainToDate: Math.round(gain),
          });
        }

        return { finalCorpus: Math.round(corpus), yearRows, totalInvested: Math.round(totalInvested) };
      }

      /**
       * Solve for starting SIP to reach target corpus (binary search)
       * @param {number} targetCorpus - target corpus in INR
       * @param {number} horizonYears - investment period
       * @param {number} annualReturnPct - expected annual return %
       * @param {number} stepdownPct - step-down rate % per year
       * @param {number} salaryMonthly - monthly salary (for bounds)
       * @param {number} annualSalaryGrowth - (optional) annual salary growth %
       * @returns {object} { status, startingSip, startingSipPct, finalCorpus, maxCorpus, yearRows }
       */
      function solveStartingSipForTarget(targetCorpus, horizonYears, annualReturnPct, stepdownPct, salaryMonthly, annualSalaryGrowth = 0) {
        const sipMin = salaryMonthly * 0.20;
        const sipMax = salaryMonthly * 0.60;
        const tolerance = Math.max(1, targetCorpus * 0.0001); // 0.01% of target or min ‚Çπ1
        const maxIterations = 60;

        let left = sipMin;
        let right = sipMax;
        let bestSip = sipMin;
        let bestResult = null;

        // Check if target is achievable at sipMax
        const maxResult = simulateCorpusStepDownSip(sipMax, horizonYears, annualReturnPct, stepdownPct, annualSalaryGrowth);
        if (maxResult.finalCorpus < targetCorpus) {
          // Target not reachable
          return {
            status: 'unreachable',
            startingSip: sipMax,
            startingSipPct: 60,
            finalCorpus: maxResult.finalCorpus,
            maxCorpus: maxResult.finalCorpus,
            yearRows: maxResult.yearRows,
            totalInvested: maxResult.totalInvested,
          };
        }

        // Binary search for the right starting SIP that achieves target without exceeding it
        for (let iter = 0; iter < maxIterations; iter++) {
          const mid = (left + right) / 2;
          const result = simulateCorpusStepDownSip(mid, horizonYears, annualReturnPct, stepdownPct, annualSalaryGrowth);
          
          if (Math.abs(result.finalCorpus - targetCorpus) <= tolerance) {
            // Found a close match
            bestSip = mid;
            bestResult = result;
            break;
          } else if (result.finalCorpus < targetCorpus) {
            // Not enough, increase SIP
            left = mid;
            bestSip = mid;
            bestResult = result;
          } else {
            // Too much, decrease SIP
            right = mid;
            // Only update best if this overshooting result is closer to target
            if (!bestResult || (result.finalCorpus - targetCorpus) < (bestResult.finalCorpus - targetCorpus)) {
              bestSip = mid;
              bestResult = result;
            }
          }
        }

        if (!bestResult) {
          bestResult = simulateCorpusStepDownSip(bestSip, horizonYears, annualReturnPct, stepdownPct, annualSalaryGrowth);
        }

        const startingSipPct = (bestSip / salaryMonthly) * 100;

        return {
          status: 'success',
          startingSip: Math.round(bestSip),
          startingSipPct: parseFloat(startingSipPct.toFixed(1)),
          finalCorpus: Math.min(bestResult.finalCorpus, targetCorpus),
          yearRows: bestResult.yearRows,
          totalInvested: bestResult.totalInvested,
        };
      }

      // ============ UI STATE & ELEMENTS ============
      const state = {
        targetCorpus: 5000000,
        horizonYears: 15,
        annualReturn: 12,
        currentSalary: 100000,
        stepdownRate: 5,
        salaryGrowth: 0,
        mode: 'auto', // 'auto' or 'manual'
        manualSipPct: 30,
      };

      const els = {
        targetCorpusRange: document.getElementById('targetCorpusRange'),
        targetCorpusInput: document.getElementById('targetCorpusInput'),
        horizonRange: document.getElementById('horizonRange'),
        horizonInput: document.getElementById('horizonInput'),
        returnRange: document.getElementById('returnRange'),
        returnInput: document.getElementById('returnInput'),
        salaryRange: document.getElementById('salaryRange'),
        salaryInput: document.getElementById('salaryInput'),
        sipMinDisplay: document.getElementById('sipMinDisplay'),
        sipMaxDisplay: document.getElementById('sipMaxDisplay'),
        stepdownRange: document.getElementById('stepdownRange'),
        stepdownInput: document.getElementById('stepdownInput'),
        salaryGrowthRange: document.getElementById('salaryGrowthRange'),
        salaryGrowthInput: document.getElementById('salaryGrowthInput'),
        manualSipSection: document.getElementById('manualSipSection'),
        manualSipPctRange: document.getElementById('manualSipPctRange'),
        manualSipPctInput: document.getElementById('manualSipPctInput'),
        manualSipDisplay: document.getElementById('manualSipDisplay'),
        warningBox: document.getElementById('warningBox'),
        requiredSipResult: document.getElementById('requiredSipResult'),
        requiredSipPctResult: document.getElementById('requiredSipPctResult'),
        finalCorpusResult: document.getElementById('finalCorpusResult'),
        totalInvestedResult: document.getElementById('totalInvestedResult'),
        totalGainResult: document.getElementById('totalGainResult'),
        sipYear1Result: document.getElementById('sipYear1Result'),
        sipYearNResult: document.getElementById('sipYearNResult'),
        stepdownAppliedResult: document.getElementById('stepdownAppliedResult'),
        scheduleTableBody: document.getElementById('scheduleTableBody'),
        recalculateBtn: document.getElementById('recalculateBtn'),
        corpusGrowthChart: document.getElementById('corpusGrowthChart'),
      };

      let chartInstance = null;

      // ============ INPUT SYNC ============
      function syncRangeInput(rangeEl, inputEl, stateKey) {
        const update = (value) => {
          const num = Number(value.replace(/,/g, ""));
          if (!Number.isFinite(num)) return;
          const min = Number(rangeEl.min);
          const max = Number(rangeEl.max);
          const clamped = clamp(num, min, max);
          state[stateKey] = clamped;
          rangeEl.value = clamped;
          inputEl.value = clamped;
          setRangeFill(rangeEl);
          render();
        };
        setRangeFill(rangeEl);
        rangeEl.addEventListener('input', (e) => update(e.target.value));
        inputEl.addEventListener('input', (e) => update(e.target.value));
      }

      function syncPlainInput(inputEl, stateKey, callback = null) {
        const update = (value) => {
          const num = Number(value.replace(/,/g, ""));
          if (!Number.isFinite(num)) return;
          state[stateKey] = num;
          if (callback) callback();
          render();
        };
        inputEl.addEventListener('input', (e) => update(e.target.value));
      }

      // ============ RENDER FUNCTION ============
      function render() {
        // Update SIP range display
        const sipMin = state.currentSalary * 0.20;
        const sipMax = state.currentSalary * 0.60;
        els.sipMinDisplay.textContent = formatINR(sipMin);
        els.sipMaxDisplay.textContent = formatINR(sipMax);

        // Update manual mode SIP display
        if (state.mode === 'manual') {
          const manualSip = (state.currentSalary * state.manualSipPct) / 100;
          els.manualSipDisplay.textContent = `SIP: ${formatINR(manualSip)}/month (${state.manualSipPct}% of salary)`;
        }

        // Compute results
        let result;
        if (state.mode === 'auto') {
          result = solveStartingSipForTarget(
            state.targetCorpus,
            state.horizonYears,
            state.annualReturn,
            state.stepdownRate,
            state.currentSalary,
            state.salaryGrowth
          );
        } else {
          // Manual mode
          const manualSipAmount = (state.currentSalary * state.manualSipPct) / 100;
          result = simulateCorpusStepDownSip(
            manualSipAmount,
            state.horizonYears,
            state.annualReturn,
            state.stepdownRate,
            state.salaryGrowth
          );
          result.status = 'manual';
          result.startingSip = Math.round(manualSipAmount);
          result.startingSipPct = state.manualSipPct;
        }

        // Display warning if unreachable
        if (result.status === 'unreachable') {
          els.warningBox.innerHTML = `<strong>‚ö†Ô∏è Target Not Reachable:</strong> Your target corpus (‚Çπ${formatNumberWithCommas(state.targetCorpus)}) exceeds the maximum achievable corpus of ‚Çπ${formatNumberWithCommas(result.finalCorpus)} at the 60% salary limit. Adjust your target, increase expected returns, or extend the time horizon.`;
          els.warningBox.style.display = 'block';
        } else {
          els.warningBox.style.display = 'none';
        }

        // Update result display
        els.requiredSipResult.textContent = formatINR(result.startingSip);
        els.requiredSipPctResult.textContent = `${result.startingSipPct}%`;
        els.finalCorpusResult.textContent = formatINR(result.finalCorpus);
        els.totalInvestedResult.textContent = formatINR(result.totalInvested);
        const totalGain = result.finalCorpus - result.totalInvested;
        els.totalGainResult.textContent = formatINR(totalGain);

        if (result.yearRows && result.yearRows.length > 0) {
          els.sipYear1Result.textContent = formatINR(result.yearRows[0].monthlySip);
          els.sipYearNResult.textContent = formatINR(result.yearRows[result.yearRows.length - 1].monthlySip);
        }
        els.stepdownAppliedResult.textContent = `${state.stepdownRate}%`;

        // Render table
        renderTable(result.yearRows);

        // Render chart
        renderChart(result.yearRows);
      }

      // ============ TABLE RENDERING ============
      function renderTable(yearRows) {
        if (!yearRows || yearRows.length === 0) {
          els.scheduleTableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: #9aa3b2;">No data to display</td></tr>';
          return;
        }

        els.scheduleTableBody.innerHTML = yearRows.map((row) => `
          <tr style="border-bottom: 1px solid var(--border);">
            <td style="padding: 12px; text-align: left; color: #6b7280;">${row.year}</td>
            <td style="padding: 12px; text-align: right; color: #0f2f2e;">‚Çπ${formatNumberWithCommas(row.monthlySip)}</td>
            <td style="padding: 12px; text-align: right; color: #0f2f2e;">‚Çπ${formatNumberWithCommas(row.annualContribution)}</td>
            <td style="padding: 12px; text-align: right; color: #0f2f2e;">‚Çπ${formatNumberWithCommas(row.cumulativeInvested)}</td>
            <td style="padding: 12px; text-align: right; color: #0f2f2e;"><strong>‚Çπ${formatNumberWithCommas(row.corpusEndOfYear)}</strong></td>
            <td style="padding: 12px; text-align: right; color: #10b981;">‚Çπ${formatNumberWithCommas(row.gainToDate)}</td>
          </tr>
        `).join('');
      }

      // ============ CHART RENDERING ============
      function renderChart(yearRows) {
        if (!yearRows || yearRows.length === 0) {
          if (chartInstance) chartInstance.destroy();
          chartInstance = null;
          return;
        }

        const labels = yearRows.map((r) => `Year ${r.year}`);
        const investedData = yearRows.map((r) => r.cumulativeInvested);
        const corpusData = yearRows.map((r) => r.corpusEndOfYear);

        const ctx = els.corpusGrowthChart.getContext('2d');

        if (chartInstance) {
          chartInstance.destroy();
        }

        chartInstance = new Chart(ctx, {
          type: 'line',
          data: {
            labels,
            datasets: [
              {
                label: 'Cumulative Invested',
                borderColor: '#0d9488',
                backgroundColor: 'rgba(13, 148, 136, 0.1)',
                data: investedData,
                tension: 0.4,
                fill: true,
                borderWidth: 2,
              },
              {
                label: 'Corpus Value',
                borderColor: '#5eead4',
                backgroundColor: 'rgba(94, 234, 212, 0.1)',
                data: corpusData,
                tension: 0.4,
                fill: true,
                borderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: {
                position: 'top',
                labels: {
                  font: { size: 12, weight: '600' },
                  color: '#6b7280',
                  usePointStyle: true,
                  padding: 16,
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: (value) => '‚Çπ' + formatNumberWithCommas(value),
                  font: { size: 11 },
                  color: '#9aa3b2',
                },
                grid: {
                  color: '#e5e7eb',
                  drawBorder: false,
                },
              },
              x: {
                ticks: {
                  font: { size: 11 },
                  color: '#9aa3b2',
                },
                grid: {
                  display: false,
                  drawBorder: false,
                },
              },
            },
          },
        });
      }

      // ============ EVENT LISTENERS ============
      // Setup range/input syncs
      syncRangeInput(els.targetCorpusRange, els.targetCorpusInput, 'targetCorpus');
      syncRangeInput(els.horizonRange, els.horizonInput, 'horizonYears');
      syncRangeInput(els.returnRange, els.returnInput, 'annualReturn');
      syncRangeInput(els.salaryRange, els.salaryInput, 'currentSalary');
      syncRangeInput(els.stepdownRange, els.stepdownInput, 'stepdownRate');
      syncRangeInput(els.salaryGrowthRange, els.salaryGrowthInput, 'salaryGrowth');
      syncRangeInput(els.manualSipPctRange, els.manualSipPctInput, 'manualSipPct');

      // Mode toggle
      document.querySelectorAll('.toggle-btn').forEach((btn) => {
        btn.addEventListener('click', (e) => {
          state.mode = e.target.dataset.mode;
          document.querySelectorAll('.toggle-btn').forEach((b) => b.classList.remove('active'));
          e.target.classList.add('active');
          els.manualSipSection.style.display = state.mode === 'manual' ? 'block' : 'none';
          render();
        });
      });

      // Recalculate button
      els.recalculateBtn.addEventListener('click', render);

      // Initial render
      render();
    </script>
  </body>
</html>
